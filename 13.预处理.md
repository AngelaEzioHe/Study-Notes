# 13.预处理

**预处理**是C语言特有的功能，包括宏定义、条件编译。

- 使用预处理功能可使程序的修改、阅读、移植和调试更加方便，也更利于实现模块化程序设计。

## 13.1 宏定义"#define"

**说明:**C语言没有规定#define必须写在函数外面，只是**规定这条命令必须单独占一个完整的逻辑行。**（如果字符串多于一行，可在行末用反斜杠 “ \ ” 进行续行）其作用范围是#define*出现的位置到所在源文件结束*，**或到相应地#undef预处理指令处。**如果需要#define仅在某个函数内有效，完全可以把它写在函数内。



### 13.1.1 不带参数的宏定义

一般形式：

```c
#define 宏名 字符串
```

- [x] **"#"**表示这是一条预处理命令。
- [x] **宏名**是一个标识符，必须符合C语言中对标识符的限定。*一般习惯用大写字母标识，以便与变量名相区别。*
- [x] **字符串**可以是常数、表达式、格式字符串等。

**注意：**

- 宏定义不是C语句，不需要在行末加分号。
- 宏替换是以字符串代替标识符。

所以可以这样子实现：

```c
#define STANDARD "You are welcome to join us."
printf(STANDARD);
```

编译程序时，遇到标识符STANDARD，就用 "You are welcome to join us." 替换。

**注意：**

通常会将所有 #define `放到文件开始处或独立的文件中`，而不是将它们分散到整个程序中。

- [x] 可以用 #undef 命令终止宏定义的作用域，例如:

- [ ] ```c
  #include<stdio.h>
  #define TEXT "this is an example"
  int main()
  {
      printf(TEXT);
      #undef TEXT
  }
  ```

- [x] 宏定义是一种预处理命令，不同于变量定义，它只做字符替换，而不分配内存空间。

### 13.1.2 带参数的宏定义

带参数的宏定义，不仅要进行字符串替换，还要进行参数替换。一般形式如下：

```c
#define 宏名（参数表） 字符串
```

**例题：**对两个数实现乘法和加法混合运算

```c
#include<stdio.h>
#include<stdlib.h>
#define MIX(a,b) (a*b+b)
int main()
{
    int x=5,y=9;
    printf("x,y:\n");
    printf("%d,%d\n",x,y);
    printf("the result is:%d\n",MIX(x,y));
    system("pause");
    return 0;
}
```

编译程序时，printf 语句将被替换为：

```c
printf("the result is:%d\n",(a*b+b));
```



## 13.2 #include命令

使用#include命令可将其他源文件的内容包含进来，即将其他文件包含到本文件之中。被读入的源文件必须用双引号或尖括号括起来。

**eg:**

```c
#include"stdio.h"
#include<stdio.h>
```

**双引号和尖括号的区别：**

- [x] 尖括号：为标准方式，系统会直接到存放C库函数头文件所在的目录中寻找要包含的文件。
- [x] 双引号：系统***先***在用户**当前目录**中寻找需要的文件，***若找不到***，***再***到存放C库函数头文件所在的目录中寻找要包含的文件。

- 通常情况下。包含库函数时，使用尖括号节省查找时间；包含用户自定义文件时，使用双引号比较快捷。文件如果不在当前目录中，双引号还可以给出文件路径。 

**经常用在文件头部的被包含文件称为标题文件或头文件你，一般以.h为后缀。一般情况下，将如下内容放到.h文件中。**

- [x] 宏定义
- [x] 结构、联合和枚举声明
- [x] typedef声明
- [x] 外部函数声明
- [x] 全局变量声明

使用头文件的好处：需要修改某些参数时不必逐个修改程序，只需修改一个文件即可。

**注意：**

- [x] 一个#include命令只能制定一个被包含的文件。
- [x] 文件包含可以嵌套，即一个被包含文件中还可以包含另一个被包含文件。
- [x] 若age.c中包含文件age.h，则预编译后两者会成为一个文件。如果age,h中有全局静态变量，则该全局变量在age.c文件中也有效，这时不需要再用exturn声明。



## 13.3 条件编译

一般情况，源程序所有行都会参与编译。如果希望其中一部分内容只在满足一定条件才进行编译，这时候需要使用条件编译命令。

### 13.3.1 #if命令

**基本含义：**如果#if命令后的**参数表达式为真**，则**编译**#if到#endif之间的程序段，否则跳过这段程序。

**一般形式如下：**

```c
#if 常数表达式
	语句段
#endif
```

- #if 和#else的关系与if和else的关秀类似
- #elif指令与 else if作用类似

#elif的一般形式如下：

```c
#if 表达式1
	语句段1
#elif 表达式2
	语句段2
...
#elif 表达式n
	语句段n
#endif
```



### 13.3.2 #ifdef 及 #ifndef命令

有时候只需要知道这个符号常量是否被定义了，使用#ifdef和#ifndef命令，分别表示“如果有定义”和“如果无定义”。

**#ifdef的一般形式如下：**（#ifdef可与#else连用）

```c
#ifdef 宏替换名
	语句段1
#else
     语句段2
#endif
```



### 13.3.3 #undef命令

使用#undef命令可以删除事先定义好的宏定义，一般形式如下：

```c
#undef 宏替换名
```

使用#undef命令可将宏名限制在特定的代码段中，如：

```c
#define MAX_SIZE 100
char array[MAX_SIZE];
#undef MAX_SIZE
```



### 13.3.4 #line命令（不会）





### 13.3.5 #pragma命令（不懂）

